# bluetooth-touch-H815.conf - Bluetooth initialization
#
# Bluetooth initialization job originally written for the Nexus 6P, adapted for the LG G4
#
# This uses the script for angler
# UGLY HACK: Since we cannot add new files to the rootfs, bindmount angler to the existing hammerhead file instead. Should be fixed on day!

description     "h815 bluetooth initialization"

stop on stopping bluetooth

script

        for i in 1 2 3 4 5; do
            sleep 3
            if [ -e /sys/class/rfkill/rfkill0/state ]; then
                break
            fi
        done

        chmod 0660 /sys/class/rfkill/rfkill0/state
        chmod 0660 /sys/class/rfkill/rfkill0/type
        chgrp dialout /sys/class/rfkill/rfkill0/state
        chgrp dialout /sys/class/rfkill/rfkill0/type
        rfkill unblock bluetooth

        /usr/bin/hciattach -p -t 30 -f /vendor/firmware /dev/ttyHS0 bcm43xx 115200 flow /data/misc/bluetooth/bdaddr &
end script